<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.2"?>
<!--
 * DBeaver - Universal Database Manager
 * Copyright (C) 2010-2024 DBeaver Corp and others
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
  -->
<plugin>
	<extension point="org.jkiss.dbeaver.generic.meta">
		<meta id="gbase8s"
			class="org.jkiss.dbeaver.ext.gbase8s.model.meta.GBase8sMetaModel"
			driverClass="com.gbasedbt.jdbc.Driver" />
	</extension>
	<extension point="org.jkiss.dbeaver.dataSourceProvider">
		<datasource
			class="org.jkiss.dbeaver.ext.gbase8s.GBase8sDataSourceProvider"
			id="gbase8s"
			description="GBase 8s connector"
			icon="icons/gbase8s_icon.png"
			parent="generic"
			dialect="gbase8s"
			label="GBase 8s">
			<!--treeInjection path="mysql/database"
				changeFolderType="org.jkiss.dbeaver.ext.oceanbase.model.OceanbaseMySQLCatalog" />
			<treeInjection path="mysql/database/view/column"
				changeFolderType="org.jkiss.dbeaver.ext.oceanbase.model.OceanbaseMySQLViewColumn" /-->

			<tree path="generic" label="GBase 8s data source"
				supportsEntityMerge="true">
				<items label="#catalog" path="catalog" property="catalogList"
					icon="#database" optional="true">
					<items label="#schema" path="schema" property="schemaList"
						icon="#database" optional="true">
						<folder
							type="org.jkiss.dbeaver.ext.gbase8s.model.GBase8sTable"
							label="%tree.tables.node.name" icon="#folder_table"
							description="%tree.tables.node.tip">
							<items label="%tree.table.node.name" path="table"
								property="physicalTables" icon="#table">
								<icon if="object.externalTable"
									icon="#table_external" />
								<icon if="object.abstractTable"
									icon="#table_alias" />
								<icon if="object.sharedTable"
									icon="#table_shared" />
								<folder
									type="org.jkiss.dbeaver.ext.gbase8s.model.GBase8sTableColumn"
									label="%tree.columns.node.name"
									icon="#columns"
									description="%tree.columns.node.tip">
									<items label="%tree.column.node.name"
										path="attribute" property="attributes"
										icon="#column">
									</items>
								</folder>
								<folder
									type="org.jkiss.dbeaver.ext.generic.model.GenericUniqueKey"
									label="%tree.uni_keys.node.name"
									icon="#constraints"
									description="%tree.uni_keys.node.tip"
									visibleIf="!object.view &amp;&amp; object.dataSource.info.supportsReferentialIntegrity()">
									<items label="%tree.uni_key.node.name"
										path="uniqueKey" property="constraints"
										icon="#unique-key">
										<items
											label="%tree.uni_key.columns.node.name"
											itemLabel="%tree.column.node.name"
											path="column"
											property="attributeReferences"
											navigable="false" inline="true">
										</items>
									</items>
								</folder>
								<folder
									type="org.jkiss.dbeaver.ext.generic.model.GenericTableForeignKey"
									label="%tree.foreign_keys.node.name"
									icon="#folder_key"
									description="%tree.foreign_keys.node.tip"
									visibleIf="!object.view &amp;&amp; object.dataSource.info.supportsReferentialIntegrity()">
									<items label="%tree.foreign_key.node.name"
										path="association"
										property="associations"
										icon="#foreign-key">
										<items
											label="%tree.foreign_key_columns.node.name"
											itemLabel="%tree.column.node.name"
											path="column"
											property="attributeReferences"
											navigable="false" inline="true">
										</items>
									</items>
								</folder>
								<folder
									type="org.jkiss.dbeaver.ext.generic.model.GenericTableIndex"
									label="%tree.indexes.node.name"
									icon="#indexes"
									description="%tree.indexes.node.tip"
									visibleIf="object.dataSource.info.supportsIndexes()">
									<items label="%tree.index.node.name"
										path="index" property="indexes"
										icon="#index">
										<items
											label="%tree.index_columns.node.name"
											path="column"
											property="attributeReferences"
											icon="#column" navigable="false"
											inline="true">
										</items>
									</items>
								</folder>
								<folder label="%tree.references.node.name"
									icon="#references"
									description="%tree.references.node.tip"
									visibleIf="!object.view &amp;&amp; object.dataSource.info.supportsReferentialIntegrity()"
									virtual="true">
									<items label="%tree.reference.node.name"
										path="reference" property="references"
										icon="#reference" virtual="true">
										<items
											label="%tree.reference_columns.node.name"
											itemLabel="%tree.column.node.name"
											path="column"
											property="attributeReferences"
											navigable="false" inline="true"
											virtual="true">
										</items>
									</items>
								</folder>
								<folder
									type="org.jkiss.dbeaver.ext.generic.model.GenericTableTrigger"
									label="%tree.triggers.node.name"
									icon="#triggers"
									description="%tree.triggers.node.tip"
									visibleIf="object.dataSource.metaModel.supportsTriggers(object.dataSource)">
									<items label="%tree.trigger.node.name"
										path="trigger" property="triggers"
										icon="#trigger" />
								</folder>
								<items label="%tree.sub_table.node.name"
									optional="true" path="subtable"
									property="subTables" icon="#table"
									recursive=".." visibleIf="!object.view">
								</items>
							</items>
						</folder>
						<folder
							type="org.jkiss.dbeaver.ext.generic.model.GenericView"
							label="%tree.tviews.node.name" icon="#folder_view"
							description="%tree.tviews.node.tip"
							visibleIf="object.dataSource.metaModel.supportsViews(object.dataSource)">
							<items label="%tree.tview.node.name" path="view"
								property="views" icon="#view">
								<folder
									type="org.jkiss.dbeaver.ext.generic.model.GenericTableColumn"
									label="%tree.columns.node.name"
									icon="#columns" description="View columns">
									<items label="%tree.column.node.name"
										path="attribute" property="attributes"
										icon="#column">
									</items>
								</folder>
							</items>
						</folder>
						<folder
							type="org.jkiss.dbeaver.ext.generic.model.GenericProcedure"
							label="%tree.procedures.node.name"
							icon="#procedures" description="Procedures"
							visibleIf="object.dataSource.info.supportsStoredCode()">
							<items label="%tree.procedures.node.name"
								itemLabel="%tree.procedure.node.name"
								path="procedure" property="proceduresOnly"
								icon="#procedure">
								<folder
									label="%tree.procedure_columns.node.name"
									icon="#columns"
									description="Procedure parameters">
									<items
										label="%tree.procedure_columns.node.name"
										itemLabel="%tree.column.node.name"
										path="column" property="parameters"
										navigable="false" />
								</folder>
							</items>
							<items label="%tree.package.node.name"
								path="package" property="packages"
								icon="#package">
								<items label="%tree.procedures.node.name"
									itemLabel="%tree.procedure.node.name"
									path="procedure" property="procedures"
									icon="#procedure">
									<items
										label="%tree.procedure_columns.node.name"
										itemLabel="%tree.column.node.name"
										path="column" property="parameters"
										navigable="false" inline="true" />
								</items>
							</items>
						</folder>
						<folder label="%tree.functions.node.name"
							icon="#functions" description="Functions"
							visibleIf="object.dataSource.info.supportsStoredCode() &amp;&amp; object.dataSource.splitProceduresAndFunctions()">
							<items label="%tree.functions.node.name"
								itemLabel="%tree.function.node.name"
								path="function" property="functionsOnly"
								icon="#function">
								<items label="%tree.function_columns.node.name"
									itemLabel="%tree.column.node.name"
									path="column" property="parameters"
									navigable="false" />
							</items>
						</folder>
						<folder
							type="org.jkiss.dbeaver.ext.generic.model.GenericSequence"
							label="%tree.sequences.node.name" icon="#sequences"
							description="%tree.sequences.node.tip"
							visibleIf="object.dataSource.metaModel.supportsSequences(object.dataSource)">
							<items label="%tree.sequence.node.name"
								path="sequence" property="sequences"
								icon="#sequence" />
						</folder>
						<folder
							type="org.jkiss.dbeaver.ext.generic.model.GenericSynonym"
							label="%tree.synonyms.node.name" icon="#synonyms"
							description="Synonyms"
							visibleIf="object.dataSource.metaModel.supportsSynonyms(object.dataSource)">
							<items label="%tree.synonym.node.name"
								path="synonym" property="synonyms"
								icon="#synonym" />
						</folder>
						<folder id="tableTrigger"
							type="org.jkiss.dbeaver.ext.gbase8s.model.GBase8sTableTrigger"
							label="%tree.tableTriggers.node.name"
							icon="#triggers"
							description="%tree.tableTriggers.node.tip"
							visibleIf="object.dataSource.metaModel.supportsTriggers(object.dataSource)">
							<items label="%tree.trigger.node.name"
								path="tableTrigger" property="tableTriggers"
								icon="#trigger" />
						</folder>
						<folder
							type="org.jkiss.dbeaver.model.struct.DBSDataType"
							label="%tree.dataTypes.node.name" icon="#data_types"
							description="%tree.dataTypes.node.tip">
							<items label="%tree.dataType.node.name"
								path="dataType" property="dataTypes"
								icon="#data_type" />
						</folder>
					</items>
				</items>
			</tree>

			<drivers managable="true">
				<driver
					id="gbase8s"
					label="GBase 8s"
					class="com.gbasedbt.jdbc.Driver"
					sampleURL="jdbc:gbasedbt-sqli://{host}:{port}/{database}:GBASEDBTSERVER={server}"
					defaultPort="9088"
					icon="icons/gbase8s_icon.png"
					iconBig="icons/gbase8s_icon_big.png"
					logoImage="icons/gbase8s_logo.png"
					description="%driver.gbase8s.description"
					defaultUser="gbasedbt"
					webURL="https://cdn.gbase.cn/products/27/duljCAzDVSy_SLTpy7j1l/GBase%208s%20V8.8%20JDBC%20Driver%20%E7%A8%8B%E5%BA%8F%E5%91%98%E6%8C%87%E5%8D%97.pdf"
					supportedPageFields="host,port,database,server"
					categories="sql">
					<property name="opt_goal" value="0" />
					<property name="sqlMode" value="oracle" />

					<property name="@dbeaver-default-database.meta.client.name.disable" value="true" />
					<property name="@dbeaver-default-dataformat.type.timestamp.pattern" value="yyyy-MM-dd HH.mm.ss.ffffff" />

					<file type="jar" path="maven:/com.gbasedbt:jdbc:RELEASE[3.5.1]" bundle="!drivers.gbase8s" />
					<file type="license" path="http://www.apache.org/licenses/LICENSE-2.0.txt" bundle="!drivers.gbase8s" />
					<file type="jar" path="drivers/gbase" bundle="drivers.gbase8s" />

					<parameter name="query-get-active-db" value="SELECT odb_dbname FROM sysmaster?sysopendb WHERE odb_iscurrent = 'Y' AND odb_sessionid = DBINFO('sessionid')" />
					<parameter name="query-set-active-db" value="DATABASE ?" />
					<parameter name="ping-sql" value="SELECT 1 FROM dual" />
					<parameter name="legacy-sql-dialect" value="true" />
					<parameter name="omit-catalog-name" value="false" />
				</driver>
			</drivers>
		</datasource>
	</extension>

	<extension point="org.jkiss.dbeaver.objectManager">
		<manager class="org.jkiss.dbeaver.ext.gbase8s.edit.GBase8sTableManager"
			objectType="org.jkiss.dbeaver.ext.gbase8s.model.GBase8sTable" />
		<manager
			class="org.jkiss.dbeaver.ext.gbase8s.edit.GBase8sTableColumnManager"
			objectType="org.jkiss.dbeaver.ext.gbase8s.model.GBase8sTableColumn" />
	</extension>

	<!--extension point="org.jkiss.dbeaver.dataSourceAuth">
		<authModel
			id="oceanbase_native"
			label="Oceanbase Native"
			description="Oceanbase native authentication (name/password)"
			class="org.jkiss.dbeaver.ext.oceanbase.model.auth.OceanbaseAuthModelDatabaseNative"
			default="true">
			<replace model="native" />
			<datasource id="oceanbase" />
		</authModel>
	</extension-->

</plugin>
